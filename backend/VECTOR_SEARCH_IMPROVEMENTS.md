# å‘é‡æ£€ç´¢ç³»ç»Ÿæ”¹è¿›è¯´æ˜

## æ”¹è¿›æ—¶é—´
2025-12-24

## é—®é¢˜è¯Šæ–­

### åŸæœ‰é—®é¢˜
1. **æè¿°è¿‡äºç®€å•**ï¼šåªä½¿ç”¨ `"é£æ ¼æ ‡ç­¾ + æƒ…ç»ª"` ç”ŸæˆåµŒå…¥å‘é‡
2. **ä¿¡æ¯æŸå¤±ä¸¥é‡**ï¼šè§†è§‰ç‰¹å¾ï¼ˆé¢œè‰²ã€å…ƒç´ ã€æè´¨ç­‰ï¼‰æœªè¢«å……åˆ†åˆ©ç”¨
3. **æ£€ç´¢ä¸å‡†ç¡®**ï¼šç›¸ä¼¼å›¾ç‰‡å¯èƒ½å› æ ‡ç­¾ä¸åŒè€Œæ— æ³•è¢«æ£€ç´¢åˆ°

### ç¤ºä¾‹å¯¹æ¯”

**æ—§æ–¹æ³•ç”Ÿæˆçš„æè¿°**ï¼š
```
"æ‰‹å·¥, è‡ªç„¶, ç®€çº¦ æ¸…æ–°è‡ªç„¶"
```

**æ–°æ–¹æ³•ç”Ÿæˆçš„æè¿°**ï¼š
```
ä¸»è¦å…ƒç´ : ç±³ç™½è‰²è´å£³, ç™½è‰²çç  | è£…é¥°: 8ä¸ªå°ç å­ | äº”é‡‘: åˆé‡‘é‡‘å±æ‰£ | é£æ ¼: æ‰‹å·¥, è‡ªç„¶, ç®€çº¦ | æƒ…ç»ª: æ¸…æ–°è‡ªç„¶ | ç‰¹å¾: ä¸­æ¬¾, è½»é‡
```

## å®æ–½çš„æ”¹è¿›

### 1. åˆ›å»ºæ ‡å‡†åŒ–æè¿°ç”Ÿæˆå·¥å…·
**æ–‡ä»¶**: `backend/services/search_utils.py`

**æ ¸å¿ƒåŠŸèƒ½**:
- `generate_search_description()`: åŸºç¡€æ ‡å‡†åŒ–æè¿°
- `generate_multimodal_search_description()`: å¢å¼ºç‰ˆæè¿°ï¼ˆæ¨èä½¿ç”¨ï¼‰

**æè¿°åŒ…å«å†…å®¹**:
1. ä¸»è¦å…ƒç´ åŠé¢œè‰²
2. è¾…åŠ©è£…é¥°å…ƒç´ åŠæ•°é‡
3. äº”é‡‘ä»¶åŠæè´¨
4. é£æ ¼æ ‡ç­¾ï¼ˆæœ€å¤š5ä¸ªï¼‰
5. æƒ…ç»ªæè¿°
6. ç‰©ç†ç‰¹å¾åˆ†ç±»ï¼ˆé•¿çŸ­ã€è½»é‡ï¼‰
7. è®¾è®¡ç‰¹ç‚¹å…³é”®è¯ï¼ˆä»å»ºè®®ä¸­æå–ï¼‰

### 2. æ›´æ–°å›¾åº“æœåŠ¡
**æ–‡ä»¶**: `backend/services/gallery_service.py`

**ä¿®æ”¹ç‚¹**:
- è¡Œ 14: å¯¼å…¥ `generate_multimodal_search_description`
- è¡Œ 75-76: ä½¿ç”¨æ–°æ–¹æ³•ç”Ÿæˆæè¿°

### 3. æ›´æ–°è®¾è®¡ä»£ç†
**æ–‡ä»¶**: `backend/agents/design_agent.py`

**ä¿®æ”¹ç‚¹**:
- è¡Œ 79: å¯¼å…¥ `generate_multimodal_search_description`
- è¡Œ 83-84: ä½¿ç”¨æ–°æ–¹æ³•ç”ŸæˆæŸ¥è¯¢æè¿°

### 4. åˆ›å»ºå‘é‡é‡æ–°ç”Ÿæˆè„šæœ¬
**æ–‡ä»¶**: `backend/scripts/regenerate_embeddings.py`

**åŠŸèƒ½**:
- é‡æ–°ç”Ÿæˆæ‰€æœ‰å›¾åº“å›¾ç‰‡çš„åµŒå…¥å‘é‡
- éªŒè¯å‘é‡å®Œæ•´æ€§
- æµ‹è¯•ç›¸ä¼¼åº¦æ£€ç´¢

**ä½¿ç”¨æ–¹æ³•**:
```bash
# é‡æ–°ç”Ÿæˆæ‰€æœ‰å‘é‡
python3 scripts/regenerate_embeddings.py

# éªŒè¯å‘é‡å®Œæ•´æ€§
python3 scripts/regenerate_embeddings.py --verify

# æµ‹è¯•ç›¸ä¼¼åº¦æ£€ç´¢
python3 scripts/regenerate_embeddings.py --test
```

## æ‰§è¡Œç»“æœ

### å‘é‡é‡æ–°ç”Ÿæˆç»Ÿè®¡
- âœ… æˆåŠŸå¤„ç†: 27 å¼ å›¾ç‰‡
- âš ï¸ è·³è¿‡: 0 å¼ 
- âŒ å¤±è´¥: 0 å¼ 
- ğŸ“Š æ€»è®¡: 27 å¼ 

### å‘é‡éªŒè¯
- æ‰€æœ‰ 27 ä¸ªå‘é‡æ­£ç¡®ç”Ÿæˆ
- å‘é‡ç»´åº¦: 1536
- å‘é‡å½’ä¸€åŒ–: norm = 1.0000

### æ£€ç´¢åŠŸèƒ½æµ‹è¯•
- âœ… ç›¸ä¼¼åº¦è®¡ç®—æ­£å¸¸
- âœ… Top-K æ’åºæ­£ç¡®
- âœ… é˜ˆå€¼è¿‡æ»¤æœ‰æ•ˆ

## é¢„æœŸæ•ˆæœ

### æ£€ç´¢å‡†ç¡®åº¦æå‡
1. **æ›´ç²¾å‡†çš„åŒ¹é…**: åŒ…å«é¢œè‰²ã€æè´¨ã€å…ƒç´ ç­‰è¯¦ç»†ç‰¹å¾
2. **æ›´å¥½çš„æ’åº**: ç›¸ä¼¼äº§å“ä¼šæœ‰æ›´é«˜çš„ç›¸ä¼¼åº¦åˆ†æ•°
3. **æ›´é²æ£’çš„æ£€ç´¢**: å³ä½¿é£æ ¼æ ‡ç­¾ç•¥æœ‰å·®å¼‚ï¼Œè§†è§‰ç‰¹å¾ç›¸ä¼¼çš„å›¾ç‰‡ä»èƒ½è¢«æ£€ç´¢åˆ°

### ç”¨æˆ·ä½“éªŒæ”¹å–„
1. ä¸Šä¼ å›¾ç‰‡åèƒ½çœ‹åˆ°æ›´ç›¸å…³çš„ç›¸ä¼¼äº§å“
2. å¸‚åœºå‚è€ƒæ›´å‡†ç¡®
3. è®¾è®¡çµæ„Ÿæ›´è´´åˆç”¨æˆ·éœ€æ±‚

## æŠ€æœ¯ç»†èŠ‚

### åµŒå…¥æ¨¡å‹
- æ¨¡å‹: `text-embedding-3-small` (OpenAI API)
- ç»´åº¦: 1536
- è¾“å…¥: ç»“æ„åŒ–æ–‡æœ¬æè¿°
- è¾“å‡º: å½’ä¸€åŒ–å‘é‡ (L2 norm = 1.0)

### ç›¸ä¼¼åº¦è®¡ç®—
- æ–¹æ³•: ä½™å¼¦ç›¸ä¼¼åº¦
- èŒƒå›´: 0.0 ~ 1.0
- æ¨èé˜ˆå€¼: 0.3 ~ 0.5

### å­˜å‚¨æ ¼å¼
- å‘é‡æ–‡ä»¶: `.npy` (NumPy äºŒè¿›åˆ¶æ ¼å¼)
- ä½ç½®: `backend/data/gallery/embeddings/`
- å‘½å: `{ref_id}.npy`

## åç»­ä¼˜åŒ–å»ºè®®

### 1. è¿ç§»åˆ°å¤šæ¨¡æ€åµŒå…¥ï¼ˆé•¿æœŸï¼‰
å¦‚æœ API æ”¯æŒå›¾åƒè¾“å…¥ï¼Œå¯ä»¥ï¼š
- ç›´æ¥ä½¿ç”¨å›¾åƒç”ŸæˆåµŒå…¥
- ç»“åˆå›¾åƒ + æ–‡æœ¬ç”Ÿæˆæ··åˆåµŒå…¥
- æå‡æ£€ç´¢å‡†ç¡®åº¦

### 2. æ€§èƒ½ä¼˜åŒ–
å½“å›¾åº“è§„æ¨¡å¢é•¿æ—¶ï¼ˆ>1000 å¼ ï¼‰ï¼š
- è€ƒè™‘ä½¿ç”¨ FAISS å»ºç«‹ç´¢å¼•
- å®ç°æ‰¹é‡æ£€ç´¢
- æ·»åŠ ç¼“å­˜æœºåˆ¶

### 3. æ£€ç´¢è´¨é‡ç›‘æ§
- æ”¶é›†ç”¨æˆ·åé¦ˆï¼ˆç›¸ä¼¼äº§å“æ˜¯å¦çœŸçš„ç›¸ä¼¼ï¼‰
- åˆ†æç›¸ä¼¼åº¦åˆ†å¸ƒ
- åŠ¨æ€è°ƒæ•´é˜ˆå€¼

## ç»´æŠ¤è¯´æ˜

### æ–°å›¾ç‰‡ä¸Šä¼ æ—¶
- è‡ªåŠ¨ä½¿ç”¨æ–°æ–¹æ³•ç”ŸæˆåµŒå…¥å‘é‡
- æ— éœ€æ‰‹åŠ¨å¹²é¢„

### å›¾åº“æ‰¹é‡å¯¼å…¥æ—¶
- è¿è¡Œ `regenerate_embeddings.py` é‡æ–°ç”Ÿæˆæ‰€æœ‰å‘é‡
- å»ºè®®åœ¨ä½å³°æœŸæ‰§è¡Œ

### æ•…éšœæ’æŸ¥
1. æ£€æŸ¥ API è¿æ¥çŠ¶æ€
2. éªŒè¯ `metadata.json` æ ¼å¼
3. ç¡®è®¤åµŒå…¥æœåŠ¡å¯ç”¨
4. æŸ¥çœ‹é”™è¯¯æ—¥å¿—

## ç›¸å…³æ–‡ä»¶æ¸…å•

### æ ¸å¿ƒæœåŠ¡
- `backend/services/search_utils.py` - æè¿°ç”Ÿæˆå·¥å…·ï¼ˆæ–°å¢ï¼‰
- `backend/services/embedding_service.py` - åµŒå…¥æœåŠ¡
- `backend/services/gallery_service.py` - å›¾åº“æœåŠ¡ï¼ˆå·²æ›´æ–°ï¼‰
- `backend/agents/design_agent.py` - è®¾è®¡ä»£ç†ï¼ˆå·²æ›´æ–°ï¼‰

### å·¥å…·è„šæœ¬
- `backend/scripts/regenerate_embeddings.py` - å‘é‡é‡æ–°ç”Ÿæˆè„šæœ¬ï¼ˆæ–°å¢ï¼‰
- `backend/scripts/cleanup_gallery_duplicates.py` - å»é‡è„šæœ¬

### æ•°æ®ç›®å½•
- `backend/data/gallery/images/` - å›¾ç‰‡æ–‡ä»¶
- `backend/data/gallery/embeddings/` - å‘é‡æ–‡ä»¶
- `backend/data/gallery/metadata.json` - å…ƒæ•°æ®ç´¢å¼•

---

**ç‰ˆæœ¬**: v1.0
**çŠ¶æ€**: âœ… å·²å®Œæˆå¹¶éªŒè¯
**ä¸‹æ¬¡æ›´æ–°**: æ ¹æ®å®é™…ä½¿ç”¨æ•ˆæœè¯„ä¼°
